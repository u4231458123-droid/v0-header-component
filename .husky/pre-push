#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

# MANDATORY QUALITY GATE - NICHT UMG-EHBAR
echo ""
echo "ğŸš¨ MANDATORY QUALITY GATE - Pre-Push Check"
echo "==========================================="
echo ""

# Phase 1: TypeScript-PrÃ¼fung
echo "ğŸ“‹ Phase 1: TypeScript-PrÃ¼fung..."
if ! pnpm exec tsc --noEmit --pretty false 2>&1 | grep -q "error TS"; then
  echo "âœ… TypeScript-PrÃ¼fung bestanden"
else
  echo ""
  echo "âŒ TYPESCRIPT-FEHLER GEFUNDEN - Push blockiert!"
  echo "ğŸ’¡ FÃ¼hre 'pnpm exec tsc --noEmit' aus, um die Fehler zu sehen."
  echo ""
  exit 1
fi

# Phase 2: Build-PrÃ¼fung
echo "ğŸ“‹ Phase 2: Build-PrÃ¼fung..."
if ! pnpm build 2>&1 | grep -q "error"; then
  echo "âœ… Build-PrÃ¼fung bestanden"
else
  echo ""
  echo "âŒ BUILD-FEHLER GEFUNDEN - Push blockiert!"
  echo "ğŸ’¡ FÃ¼hre 'pnpm build' aus, um die Fehler zu sehen."
  echo ""
  exit 1
fi

# Phase 3: Bot-Validation
echo "ğŸ“‹ Phase 3: Bot-Validation..."
node scripts/cicd/mandatory-quality-gate.js --pre-push

# Exit-Code prÃ¼fen
if [ $? -ne 0 ]; then
  echo ""
  echo "âŒ QUALITY GATE FEHLGESCHLAGEN - Push blockiert!"
  echo "ğŸ’¡ Behebe die Fehler und versuche es erneut."
  echo ""
  exit 1
fi

echo ""
echo "âœ… ALLE PRÃœFUNGEN BESTANDEN - Push erlaubt"
echo ""

